<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invite User - ChemTrack</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font for a modern look */
        body {
            font-family: "Inter", sans-serif;
            /* Default Light Mode Colors */
            --bg-color: #f8fafc;
            --text-color-primary: #1a202c; /* gray-900 */
            --text-color-secondary: #4a5568; /* gray-700 */
            --navbar-bg: #ffffff;
            --card-bg: #ffffff;
            --border-color: #e2e8f0;
            --dropdown-bg: #ffffff;
            --dropdown-item-hover-bg: #f0f2f5;
            --header-text-color: #2d3748; /* gray-800 */
            --link-color: #6366f1; /* indigo-500 */
            --link-hover-color: #4f46e5; /* indigo-600 */
            --footer-bg: #2d3748; /* gray-800 */
            --footer-text: #ffffff;
            --footer-link: #a0aec0; /* gray-400 */
            --footer-link-hover: #ffffff;
            --input-bg: #ffffff;
            --input-border: #cbd5e1;
            --table-header-bg: #edf2f7;
            --table-row-hover-bg: #f7fafc;
            --alert-info-bg: #3b82f6;
            --alert-success-bg: #22c55e;
            --alert-error-bg: #ef4444;
            --alert-warning-bg: #f59e0b;

            background-color: var(--bg-color);
            color: var(--text-color-primary);
            margin: 0;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Dark Mode Colors */
        body[data-theme="dark"] {
            --bg-color: #1a202c;
            --text-color-primary: #e2e8f0;
            --text-color-secondary: #a0aec0;
            --navbar-bg: #2d3748;
            --card-bg: #2d3748;
            --border-color: #4a5568;
            --dropdown-bg: #2d3748;
            --dropdown-item-hover-bg: #4a5568;
            --header-text-color: #e2e8f0;
            --link-color: #818cf8;
            --link-hover-color: #6366f1;
            --footer-bg: #1a202c;
            --footer-text: #e2e8f0;
            --footer-link: #a0aec0;
            --footer-link-hover: #ffffff;
            --input-bg: #2d3748;
            --input-border: #4a5568;
            --table-header-bg: #4a5568;
            --table-row-hover-bg: #2d3748;
            --alert-info-bg: #60a5fa;
            --alert-success-bg: #4ade80;
            --alert-error-bg: #f87171;
            --alert-warning-bg: #fbbf24;
        }

        /* Navbar styling */
        .navbar {
            background-color: var(--navbar-bg);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            z-index: 10;
            transition: background-color 0.3s ease;
        }
        .navbar .text-gray-900 { color: var(--text-color-primary); }
        .navbar .text-indigo-600 { color: var(--link-color); }
        .navbar .text-gray-700 { color: var(--text-color-secondary); }
        .navbar .hover\:text-indigo-600:hover { color: var(--link-hover-color); }

        @media (min-width: 768px) {
            .navbar {
                padding: 1rem 2rem;
            }
        }
        @media (min-width: 1024px) {
            .navbar {
                padding: 1rem 3rem;
            }
        }

        /* Dropdown menu styling */
        .dropdown-menu {
            position: absolute;
            right: 1.5rem;
            top: 4.5rem;
            background-color: var(--dropdown-bg);
            border-radius: 0.75rem;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            min-width: 12rem;
            z-index: 20;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: opacity 0.2s ease-out, transform 0.2s ease-out, visibility 0.2s, background-color 0.3s ease;
            border: 1px solid var(--border-color);
        }
        .dropdown-menu.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        .dropdown-item {
            padding: 0.75rem 1rem;
            color: var(--text-color-secondary);
            display: block;
            text-decoration: none;
            transition: background-color 0.15s ease-in-out, color 0.15s ease-in-out;
            cursor: pointer;
        }
        .dropdown-item:hover {
            background-color: var(--dropdown-item-hover-bg);
            color: var(--link-hover-color);
        }
        .dropdown-item:first-child {
            border-top-left-radius: 0.75rem;
            border-top-right-radius: 0.75rem;
        }
        .dropdown-item:last-child {
            border-bottom-left-radius: 0.75rem;
            border-bottom-right-radius: 0.75rem;
        }
        .dropdown-header {
            padding: 0.75rem 1rem;
            font-weight: 600;
            color: var(--header-text-color);
            border-bottom: 1px solid var(--border-color);
            transition: color 0.3s ease, border-color 0.3s ease;
        }

        /* Main content section padding */
        .section-padding {
            padding: 2rem 1rem;
            flex-grow: 1;
        }
        @media (min-width: 768px) {
            .section-padding {
                padding: 3rem 2rem;
            }
        }
        @media (min-width: 1024px) {
            .section-padding {
                padding: 4rem 3rem;
            }
        }

        /* Form and Card styling */
        .form-card, .table-card {
            background-color: var(--card-bg);
            border-radius: 1rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            padding: 2rem;
            border: 1px solid var(--border-color);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .input-field, .select-field {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--input-border);
            border-radius: 0.5rem;
            background-color: var(--input-bg);
            color: var(--text-color-primary);
            transition: border-color 0.2s ease, background-color 0.3s ease, color 0.3s ease;
            outline: none;
        }
        .input-field:focus, .select-field:focus {
            border-color: var(--link-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }
        .btn-primary {
            background-color: #6366f1;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
            cursor: pointer;
        }
        .btn-primary:hover {
            background-color: #4f46e5;
        }
        .btn-danger {
            background-color: #ef4444; /* red-500 */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
            cursor: pointer;
        }
        .btn-danger:hover {
            background-color: #dc2626; /* red-600 */
        }


        .user-table { /* Changed from invite-table */
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
            color: var(--text-color-primary);
        }
        .user-table th, .user-table td { /* Changed from invite-table */
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
            text-align: left;
        }
        .user-table th { /* Changed from invite-table */
            background-color: var(--table-header-bg);
            font-weight: 600;
            color: var(--header-text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .user-table tbody tr:hover { /* Changed from invite-table */
            background-color: var(--table-row-hover-bg);
            transition: background-color 0.2s ease;
        }
        .user-table tbody tr:last-child td { /* Changed from invite-table */
            border-bottom: none;
        }

        /* Footer styling */
        footer {
            background-color: var(--footer-bg);
            color: var(--footer-text);
            transition: background-color 0.3s ease, color 0.3s ease;
            margin-top: auto;
        }
        footer a {
            color: var(--footer-link);
            transition: color 0.3s ease;
        }
        footer a:hover {
            color: var(--footer-link-hover);
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="flex items-center">
            <a href="homepage.html" class="text-3xl font-bold text-gray-900 tracking-tight">
                <span class="text-indigo-600">Chem</span>Track
            </a>
        </div>
        <div class="relative">
            <button id="settingsBtn" class="flex items-center space-x-2 text-gray-700 hover:text-indigo-600 focus:outline-none">
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.525.322 1.017.5 1.58.5z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                <span class="hidden md:block text-lg font-medium">Settings</span>
            </button>
            <div id="settingsDropdown" class="dropdown-menu">
                <div class="dropdown-header">
                    <span id="userNameDisplay">Loading...</span> (<span id="userRoleDisplay">Loading...</span>)
                    <br>
                    <span id="userEmailDisplay" class="text-sm text-gray-500">Loading...</span>
                </div>
                <a href="user-dashboard.html" class="dropdown-item">User Dashboard</a>
                <a href="admin-dashboard.html" class="dropdown-item">Admin Dashboard</a>
                <a href="chemical-usage.html" class="dropdown-item">Chemical Usage Log</a>
                <a href="#" class="dropdown-item" id="darkModeToggle">Toggle Mode</a>
                <a href="#" class="dropdown-item bg-red-600 hover:bg-red-700 text-white font-semibold rounded-b-lg" id="logoutBtn">Logout</a>
            </div>
        </div>
    </nav>

    <main class="pt-20 section-padding">
        <h1 class="text-4xl font-extrabold text-gray-900 text-center mb-12">
            Invite New User
        </h1>

        <div class="max-w-xl mx-auto grid grid-cols-1 gap-8">
            <!-- Invite User Form -->
            <div class="form-card">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">Send Invitation</h2>
                <div id="adminAccessMessage" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-xl relative mb-4" role="alert">
                    <strong class="font-bold">Access Denied!</strong>
                    <span class="block sm:inline">Only administrators can invite new users.</span>
                </div>
                <form id="inviteUserForm" class="space-y-4">
                    <div>
                        <label for="inviteEmail" class="block text-sm font-medium text-gray-700 mb-1">User Email</label>
                        <input type="email" id="inviteEmail" class="input-field" placeholder="Enter user's email" required>
                    </div>
                    <div>
                        <label for="inviteRole" class="block text-sm font-medium text-gray-700 mb-1">User Role</label>
                        <select id="inviteRole" class="select-field" required>
                            <option value="user">User</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <button type="submit" class="btn-primary w-full">Send Invite</button>
                </form>
            </div>

            <!-- Existing Users Table -->
            <div class="table-card">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">Existing Users</h2>
                <div class="overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-700">
                    <table class="user-table">
                        <thead>
                            <tr>
                                <th>Email</th>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Users will be loaded here by JavaScript -->
                            <tr><td colspan="4" class="text-center py-4 text-gray-500">No users found.</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 px-4 md:px-8 lg:px-12 text-center mt-8">
        <p>&copy; 2025 ChemTrack. All rights reserved.</p>
        <div class="mt-4 text-sm">
            <a href="#" class="text-gray-400 hover:text-white mx-2">Privacy Policy</a>
            <span class="text-gray-500">|</span>
            <a href="#" class="text-gray-400 hover:text-white mx-2">Terms of Service</a>
        </div>
    </footer>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, collection, query, onSnapshot, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-functions.js";


        // Global variables for Firebase config and app ID
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = {
            apiKey: "AIzaSyBxxDfMvpB3dTCzBeX2vTd8R2ZhmayHXo4",
            authDomain: "aditya-suryawanshi-chem.firebaseapp.com",
            projectId: "aditya-suryawanshi-chem",
            storageBucket: "aditya-suryawanshi-chem.firebasestorage.app",
            messagingSenderId: "1056550959635",
            appId: "1:1056550959635:web:9944e9ae52f3b559a7dde6",
            measurementId: "G-XXP0XPBNW0",
        };

        let app, auth, db, functions;
        let currentUserId = null;
        let currentUserRole = null;
        let currentUserName = "Unknown User";

        // Initialize Firebase and set up authentication listener
        async function initializeFirebase() {
            try {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                functions = getFunctions(app); // Initialize Cloud Functions SDK

                // Attempt to sign in with custom token if available
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                    console.log("Signed in with custom token.");
                } else {
                    console.log("No initial auth token found. User will be redirected if not already signed in.");
                }

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        currentUserId = user.uid;
                        console.log("User is signed in:", currentUserId);
                        await fetchUserProfile(currentUserId); // Fetch user profile to get role and name
                        listenForUsers(); // Start listening for all users
                    } else {
                        currentUserId = null;
                        currentUserRole = null;
                        currentUserName = "Unknown User";
                        console.log("No user is signed in. Redirecting to login.");
                        alertPlaceholder("You are not logged in. Redirecting to login page.", "error");
                        setTimeout(() => {
                            window.location.href = 'auth-page.html#login';
                        }, 2000);
                    }
                });
            } catch (error) {
                console.error("Error initializing Firebase:", error);
                alertPlaceholder("Failed to initialize application. Please try again.", "error");
            }
        }

        // Fetch user profile data (for dropdown display and role check)
        async function fetchUserProfile(uid) {
            try {
                if (!uid) {
                    console.error("fetchUserProfile: UID is null or undefined.");
                    document.getElementById('userNameDisplay').textContent = 'Guest';
                    document.getElementById('userRoleDisplay').textContent = 'N/A';
                    document.getElementById('userEmailDisplay').textContent = 'guest@example.com';
                    currentUserRole = null;
                    currentUserName = "Guest";
                    return;
                }

                const userDocRef = doc(db, 'users', uid);
                const userDocSnap = await getDoc(userDocRef);

                if (userDocSnap.exists()) {
                    const userData = userDocSnap.data();
                    document.getElementById('userNameDisplay').textContent = userData.name || 'User';
                    document.getElementById('userEmailDisplay').textContent = userData.email || 'N/A';
                    document.getElementById('userRoleDisplay').textContent = userData.role ? userData.role.charAt(0).toUpperCase() + userData.role.slice(1) : 'N/A';
                    currentUserRole = userData.role;
                    currentUserName = userData.name || userData.email || "Unknown User";
                } else {
                    console.warn("User profile document does not exist for UID:", uid);
                    document.getElementById('userNameDisplay').textContent = 'User Not Found';
                    document.getElementById('userRoleDisplay').textContent = 'N/A';
                    document.getElementById('userEmailDisplay').textContent = 'N/A';
                    currentUserRole = null;
                    currentUserName = "User Not Found";
                    alertPlaceholder("User profile missing. Please ensure your profile is complete.", "warning");
                }
                checkAdminAccess(); // Check access after role is set
            } catch (error) {
                console.error("Error fetching user profile:", error);
                alertPlaceholder("Failed to load user profile.", "error");
            }
        }

        // Check if the current user has admin access
        function checkAdminAccess() {
            const inviteUserForm = document.getElementById('inviteUserForm');
            const adminAccessMessage = document.getElementById('adminAccessMessage');
            if (currentUserRole === 'admin') {
                inviteUserForm.classList.remove('hidden');
                adminAccessMessage.classList.add('hidden');
            } else {
                inviteUserForm.classList.add('hidden');
                adminAccessMessage.classList.remove('hidden');
                alertPlaceholder("You do not have administrative privileges to invite new users.", "warning");
            }
        }

        // Handle form submission for inviting a user
        document.getElementById('inviteUserForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            if (currentUserRole !== 'admin') {
                alertPlaceholder("You do not have permission to invite users.", "error");
                return;
            }

            const inviteEmail = document.getElementById('inviteEmail').value.trim();
            const inviteRole = document.getElementById('inviteRole').value;

            if (!inviteEmail || !inviteRole) {
                alertPlaceholder("Please enter both email and select a role.", "error");
                return;
            }

            // Basic email format validation
            if (!/\S+@\S+\.\S+/.test(inviteEmail)) {
                alertPlaceholder("Please enter a valid email address.", "error");
                return;
            }

            try {
                // Get the callable Cloud Function reference
                const inviteUserCallable = httpsCallable(functions, 'inviteUserByAdmin');

                // Call the Cloud Function with user data
                const result = await inviteUserCallable({
                    email: inviteEmail,
                    role: inviteRole,
                    invitedByName: currentUserName // Pass the admin's name
                });

                console.log("Cloud Function response:", result.data);

                if (result.data.success) {
                    alertPlaceholder(`Invitation sent to ${inviteEmail}! User can now set up their password and log in.`, "success");
                    document.getElementById('inviteUserForm').reset();
                } else {
                    alertPlaceholder(`Failed to send invitation: ${result.data.error}`, "error");
                }

            } catch (error) {
                console.error("Error calling Cloud Function to invite user:", error);
                alertPlaceholder(`Failed to send invitation: ${error.message}`, "error");
            }
        });

        // Listen for real-time updates to all users (for the table)
        function listenForUsers() {
            // Ensure db is initialized and user is authenticated before listening
            if (!db || !currentUserId) {
                console.warn("Firestore not initialized or user not authenticated. Cannot listen for users.");
                return;
            }

            const usersCollectionRef = collection(db, 'users');
            const q = query(usersCollectionRef);

            onSnapshot(q, (snapshot) => {
                const users = [];
                snapshot.forEach(doc => {
                    const userData = doc.data();
                    // Exclude the currently logged-in user from the list for self-management simplicity
                    if (doc.id !== currentUserId) {
                        users.push({ id: doc.id, ...userData });
                    }
                });
                displayUsers(users);
            }, (error) => {
                console.error("Error listening to users collection:", error);
                alertPlaceholder("Failed to load user list.", "error");
            });
        }

        // Display users in the table
        function displayUsers(users) {
            const tableBody = document.getElementById('usersTableBody');
            tableBody.innerHTML = ''; // Clear existing rows

            if (users.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" class="text-center py-4 text-gray-500">No users found.</td></tr>';
                return;
            }

            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.email || 'N/A'}</td>
                    <td>${user.name || 'N/A'}</td>
                    <td>${user.role ? user.role.charAt(0).toUpperCase() + user.role.slice(1) : 'N/A'}</td>
                    <td>
                        <button class="btn-danger text-sm px-3 py-1 rounded-md" data-id="${user.id}">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            // Add event listeners for delete buttons
            tableBody.querySelectorAll('.btn-danger').forEach(button => {
                button.addEventListener('click', (e) => {
                    const userIdToDelete = e.target.dataset.id;
                    showCustomConfirm(`Are you sure you want to delete user ${userIdToDelete}? This action cannot be undone.`, () => deleteUser(userIdToDelete));
                });
            });
        }

        // Function to delete a user
        async function deleteUser(userIdToDelete) {
            try {
                if (currentUserRole !== 'admin') {
                    alertPlaceholder("You do not have permission to delete users.", "error");
                    return;
                }

                // Call the Cloud Function to delete the user
                const deleteUserCallable = httpsCallable(functions, 'deleteUserByAdmin');
                const result = await deleteUserCallable({ uid: userIdToDelete });

                if (result.data.success) {
                    alertPlaceholder(`User ${userIdToDelete} deleted successfully!`, "success");
                } else {
                    alertPlaceholder(`Failed to delete user: ${result.data.error}`, "error");
                }
            } catch (error) {
                console.error("Error calling Cloud Function to delete user:", error);
                alertPlaceholder(`Failed to delete user: ${error.message}`, "error");
            }
        }


        // Toggle settings dropdown
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsDropdown = document.getElementById('settingsDropdown');

        settingsBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            settingsDropdown.classList.toggle('active');
        });

        window.addEventListener('click', (e) => {
            if (!settingsBtn.contains(e.target) && !settingsDropdown.contains(e.target)) {
                settingsDropdown.classList.remove('active');
            }
        });

        // Handle logout
        document.getElementById('logoutBtn').addEventListener('click', async (e) => {
            e.preventDefault();
            try {
                await signOut(auth);
                alertPlaceholder("Logged out successfully!", "success");
                setTimeout(() => {
                    window.location.href = 'homepage.html';
                }, 1500);
            } catch (error) {
                console.error("Error logging out:", error);
                alertPlaceholder("Failed to log out. Please try again.", "error");
            }
        });

        // Dark Mode / Light Mode Toggle
        const darkModeToggle = document.getElementById('darkModeToggle');

        function applyTheme(theme) {
            document.body.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            darkModeToggle.textContent = theme === 'dark' ? 'Light Mode' : 'Dark Mode';
        }

        darkModeToggle.addEventListener('click', (e) => {
            e.preventDefault();
            const currentTheme = document.body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            applyTheme(newTheme);
            alertPlaceholder(`Switched to ${newTheme} mode!`, "info");
        });

        // Initialize theme on load
        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            applyTheme(savedTheme);
        }

        // Placeholder for a custom alert/message box (since alert() is not allowed)
        function alertPlaceholder(message, type = "info") {
            const existingAlert = document.getElementById('customAlert');
            if (existingAlert) {
                existingAlert.remove();
            }

            const alertDiv = document.createElement('div');
            alertDiv.id = 'customAlert';
            alertDiv.className = `fixed top-4 left-1/2 -translate-x-1/2 px-6 py-3 rounded-xl shadow-lg z-50 text-white font-semibold transition-all duration-300 ease-in-out transform opacity-0 scale-95`;

            if (type === "success") {
                alertDiv.style.backgroundColor = 'var(--alert-success-bg)';
            } else if (type === "error") {
                alertDiv.style.backgroundColor = 'var(--alert-error-bg)';
            } else if (type === "warning") {
                alertDiv.style.backgroundColor = 'var(--alert-warning-bg)';
            }
            else {
                alertDiv.style.backgroundColor = 'var(--alert-info-bg)';
            }

            alertDiv.textContent = message;
            document.body.appendChild(alertDiv);

            setTimeout(() => {
                alertDiv.style.opacity = '1';
                alertDiv.style.transform = 'translate(-50%, 0) scale(1)';
            }, 50);

            setTimeout(() => {
                alertDiv.style.opacity = '0';
                alertDiv.style.transform = 'translate(-50%, -20px) scale(0.9)';
                setTimeout(() => alertDiv.remove(), 300);
            }, 3000);
        }

        // Custom Confirmation Modal (replaces window.confirm)
        function showCustomConfirm(message, onConfirm) {
            const existingConfirm = document.getElementById('customConfirmModal');
            if (existingConfirm) {
                existingConfirm.remove();
            }

            const modalOverlay = document.createElement('div');
            modalOverlay.id = 'customConfirmModal';
            modalOverlay.className = `fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 transition-opacity duration-300 ease-in-out opacity-0`;
            modalOverlay.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl max-w-sm mx-auto transform scale-95 opacity-0 transition-all duration-300 ease-in-out">
                    <p class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">${message}</p>
                    <div class="flex justify-end space-x-3">
                        <button id="confirmCancelBtn" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-700 transition">Cancel</button>
                        <button id="confirmOkBtn" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition">Delete</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modalOverlay);

            // Animate in
            setTimeout(() => {
                modalOverlay.style.opacity = '1';
                modalOverlay.querySelector('div').style.opacity = '1';
                modalOverlay.querySelector('div').style.transform = 'scale(1)';
            }, 50);

            document.getElementById('confirmOkBtn').addEventListener('click', () => {
                onConfirm();
                modalOverlay.remove();
            });

            document.getElementById('confirmCancelBtn').addEventListener('click', () => {
                modalOverlay.remove();
            });
        }


        // Initialize Firebase and Theme when the window loads
        window.onload = () => {
            initializeFirebase();
            initializeTheme();
        };
    </script>
</body>
</html>
